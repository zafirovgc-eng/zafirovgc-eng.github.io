<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FruitBox - Men√∫ Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; }
        .juice-card, .prep-option, .sweet-option, .size-option, .delivery-option, .payment-option, .extra-item { transition: all 0.3s ease; }
        .selected { 
            border: 4px solid #059669 !important; 
            background: linear-gradient(135deg, #ecfdf5, #d1fae5) !important; 
            box-shadow: 0 0 0 2px #10b981, 0 4px 12px rgba(16, 185, 129, 0.3) !important;
            transform: scale(1.02) !important;
        }
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .shake-animation {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
            perspective: 1000px;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-orange-50 min-h-screen">
    <!-- Bot√≥n de carrito flotante -->
    <div class="fixed top-4 right-4 z-50">
        <button onclick="toggleCart()" class="bg-gray-800 text-white px-6 py-2 rounded-full font-medium hover:bg-gray-700 transition-colors relative shadow-lg">
            üõí Ver Carrito (<span id="cart-count">0</span>)
        </button>
    </div>

    <!-- Header -->
    <div class="bg-gradient-to-r from-green-500 to-orange-500 text-white p-4 text-center">
        <h1 class="text-3xl font-bold mb-1">üçπ FruitBox</h1>
        <p class="text-sm italic mt-1">Tu jugo, tu estilo, tu fruitbox!</p>
        
        <!-- Social Media Buttons -->
        <div class="mt-3 flex gap-2 justify-center">
            <a href="https://www.facebook.com/profile.php?id=" target="_blank" class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-full text-xs font-medium transition-colors">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
                Facebook
            </a>
            <a href="https://www.instagram.com/fruitbox_mxl/" target="_blank" class="inline-flex items-center gap-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-3 py-2 rounded-full text-xs font-medium transition-colors">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM12 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                </svg>
                Instagram
            </a>
        </div>
    </div>

    <div class="container mx-auto p-3 max-w-md">
        <!-- Men√∫ Principal -->
        <div class="bg-white rounded-2xl shadow-xl p-4 mb-4">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">üåü Nuestros Jugos Especiales</h2>
            
            <div class="grid grid-cols-1 gap-3 mb-4">
                <div class="juice-card bg-gradient-to-br from-green-100 to-green-200 p-3 rounded-xl cursor-pointer border-2 border-transparent flex items-center gap-3" onclick="selectJuice('verde')">
                    <div class="text-3xl">üíö</div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-green-800">Green Day</h3>
                        <p class="text-green-700 text-xs">Pi√±a, kale, apio, mango, nopal</p>
                    </div>
                    <div class="text-lg font-bold text-green-800">$55</div>
                </div>

                <div class="juice-card bg-gradient-to-br from-orange-100 to-orange-200 p-3 rounded-xl cursor-pointer border-2 border-transparent flex items-center gap-3" onclick="selectJuice('naranja')">
                    <div class="text-3xl">üß°</div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-orange-800">AC/DCitrus</h3>
                        <p class="text-orange-700 text-xs">Jugo de naranja natural con zanahoria opcional</p>
                    </div>
                    <div class="text-lg font-bold text-orange-800">$55</div>
                </div>

                <div class="juice-card bg-gradient-to-br from-yellow-100 to-yellow-200 p-3 rounded-xl cursor-pointer border-2 border-transparent flex items-center gap-3" onclick="selectJuice('mango')">
                    <div class="text-3xl">üíõ</div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-yellow-800">Mango Van Gogh</h3>
                        <p class="text-yellow-700 text-xs">Puro mango dulce</p>
                    </div>
                    <div class="text-lg font-bold text-yellow-800">$60</div>
                </div>

                <div class="juice-card bg-gradient-to-br from-purple-100 to-purple-200 p-3 rounded-xl cursor-pointer border-2 border-transparent flex items-center gap-3" onclick="selectJuice('berries')">
                    <div class="text-3xl">üçá</div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-purple-800">Berryonc√©</h3>
                        <p class="text-purple-700 text-xs">Frambuesa, mora azul, zarzamora</p>
                    </div>
                    <div class="text-lg font-bold text-purple-800">$65</div>
                </div>

                <div class="juice-card bg-gradient-to-br from-pink-100 to-pink-200 p-3 rounded-xl cursor-pointer border-2 border-transparent flex items-center gap-3" onclick="selectJuice('fresa')">
                    <div class="text-3xl">‚ù§Ô∏è</div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-pink-800">Adeleicious</h3>
                        <p class="text-pink-700 text-xs">Licuado de fresa (con pl√°tano opcional)</p>
                    </div>
                    <div class="text-lg font-bold text-pink-800">$60</div>
                </div>

                <div class="juice-card bg-gradient-to-br from-blue-100 to-blue-200 p-3 rounded-xl cursor-pointer border-2 border-transparent flex items-center gap-3" onclick="selectJuice('personalizado')">
                    <div class="text-3xl">‚≠ê</div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-blue-800">¬°Crea el Tuyo!</h3>
                        <p class="text-blue-700 text-xs">Combina como quieras</p>
                    </div>
                </div>
            </div>
            
        </div>

        <!-- Carrito de Compras -->
        <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[80vh] overflow-y-auto">
                    <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="text-xl font-bold text-gray-800">üõí Tu Carrito</h3>
                        <button onclick="toggleCart()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    
                    <div id="cart-items" class="p-4">
                        <div id="empty-cart" class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">üõí</div>
                            <p>Tu carrito est√° vac√≠o</p>
                            <p class="text-sm">¬°Agrega algunos jugos deliciosos!</p>
                        </div>
                    </div>
                    
                    <div id="cart-summary" class="hidden border-t border-gray-200 p-4 bg-gray-50">
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between text-sm">
                                <span>Subtotal:</span>
                                <span id="cart-subtotal">$0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span>Env√≠o:</span>
                                <span id="cart-shipping">$0</span>
                            </div>
                            <div class="flex justify-between font-bold text-lg border-t pt-2">
                                <span>Total:</span>
                                <span id="cart-total">$0</span>
                            </div>
                        </div>
                        
                        <button onclick="proceedToCheckout()" class="w-full bg-gradient-to-r from-green-500 to-orange-500 text-white font-bold py-3 rounded-xl hover:from-green-600 hover:to-orange-600 transition-colors">
                            Proceder al Checkout
                        </button>
                    </div>
                </div></div>
        </div>

        <!-- Modal de confirmaci√≥n para agregar m√°s -->
        <div id="add-more-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 text-center">
                    <h3 class="text-2xl font-bold mb-4">¬°Jugo agregado!</h3>
                    <p class="text-gray-600 mb-6">¬øDeseas agregar otro jugo a tu pedido?</p>
                    <div class="flex justify-center space-x-4">
                        <button onclick="addAnotherJuice()" class="bg-green-500 text-white font-bold px-6 py-3 rounded-full hover:bg-green-600 transition-colors">
                            S√≠, otro m√°s
                        </button>
                        <button onclick="proceedToFinalCheckout()" class="bg-gray-800 text-white font-bold px-6 py-3 rounded-full hover:bg-gray-700 transition-colors">
                            No, finalizar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para programar un pedido de jugo espec√≠fico -->
        <div id="schedule-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4 hidden">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">üìÖ Programar Pedido</h3>
                    <button onclick="hideScheduleModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha</label>
                        <input type="date" id="scheduled-date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Hora</label>
                        <input type="time" id="scheduled-time" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notas (opcional)</label>
                        <textarea id="scheduled-notes" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
                    </div>
                    <button onclick="sendScheduledJuiceWhatsApp()" class="w-full bg-green-500 text-white font-bold py-3 rounded-xl hover:bg-green-600 transition-colors">
                        Enviar Pedido Programado
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mensajes Modales (Reemplazo de alert) -->
        <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4 hidden">
            <div class="bg-white rounded-lg shadow-xl p-6 text-center max-w-sm w-full">
                <div id="modal-icon" class="text-4xl mb-4"></div>
                <div id="modal-text" class="text-gray-800 mb-4"></div>
                <button onclick="hideModal()" class="bg-gray-800 text-white px-4 py-2 rounded-full text-sm font-medium">OK</button>
            </div>
        </div>

        <!-- Extras para Personalizar -->
        <div id="extras-section" class="bg-white rounded-2xl shadow-xl p-4 mb-4 hidden">
            <h3 class="text-xl font-bold mb-3 text-gray-800">üåà Crea el Tuyo</h3>
            <p class="text-sm text-gray-600 mb-3">Los costos pueden variar de acuerdo a su selecci√≥n</p>
            <div class="grid grid-cols-3 gap-2">
                <div class="extra-item bg-green-100 p-2 rounded-lg text-center cursor-pointer hover:bg-green-200" onclick="toggleExtra('pepino')">
                    <div class="text-xl mb-1">ü•í</div>
                    <div class="text-xs font-medium">Pepino</div>
                </div>
                <div class="extra-item bg-green-100 p-2 rounded-lg text-center cursor-pointer hover:bg-green-200" onclick="toggleExtra('apio')">
                    <div class="text-xl mb-1">ü•¨</div>
                    <div class="text-xs font-medium">Apio</div>
                </div>
                <div class="extra-item bg-pink-100 p-2 rounded-lg text-center cursor-pointer hover:bg-pink-200" onclick="toggleExtra('fresa')">
                    <div class="text-xl mb-1">üçì</div>
                    <div class="text-xs font-medium">Fresa</div>
                </div>
                <div class="extra-item bg-yellow-100 p-2 rounded-lg text-center cursor-pointer hover:bg-yellow-200" onclick="toggleExtra('platano')">
                    <div class="text-xl mb-1">üçå</div>
                    <div class="text-xs font-medium">Pl√°tano</div>
                </div>
                <div class="extra-item bg-yellow-100 p-2 rounded-lg text-center cursor-pointer hover:bg-yellow-200" onclick="toggleExtra('limon')">
                    <div class="text-xl mb-1">üçã</div>
                    <div class="text-xs font-medium">Lim√≥n</div>
                </div>
                <div class="extra-item bg-orange-100 p-2 rounded-lg text-center cursor-pointer hover:bg-orange-200" onclick="toggleExtra('naranja')">
                    <div class="text-xl mb-1">üçä</div>
                    <div class="text-xs font-medium">Naranja</div>
                </div>
                <div class="extra-item bg-orange-100 p-2 rounded-lg text-center cursor-pointer hover:bg-orange-200" onclick="toggleExtra('papaya')">
                    <div class="text-xl mb-1">üß°</div>
                    <div class="text-xs font-medium">Papaya</div>
                </div>
                <div class="extra-item bg-green-100 p-2 rounded-lg text-center cursor-pointer hover:bg-green-200" onclick="toggleExtra('manzana')">
                    <div class="text-xl mb-1">üçè</div>
                    <div class="text-xs font-medium">Manzana</div>
                </div>
                <div class="extra-item bg-yellow-100 p-2 rounded-lg text-center cursor-pointer hover:bg-yellow-200" onclick="toggleExtra('mango')">
                    <div class="text-xl mb-1">ü•≠</div>
                    <div class="text-xs font-medium">Mango</div>
                </div>
                <div class="extra-item bg-purple-100 p-2 rounded-lg text-center cursor-pointer hover:bg-purple-200" onclick="toggleExtra('berries')">
                    <div class="text-xl mb-1">üçá</div>
                    <div class="text-xs font-medium">Berries</div>
                </div>
                <div class="extra-item bg-orange-100 p-2 rounded-lg text-center cursor-pointer hover:bg-orange-200" onclick="toggleExtra('zanahoria')">
                    <div class="text-xl mb-1">ü•ï</div>
                    <div class="text-xs font-medium">Zanahoria</div>
                </div>
                <div class="extra-item bg-green-100 p-2 rounded-lg text-center cursor-pointer hover:bg-green-200" onclick="toggleExtra('espinaca')">
                    <div class="text-xl mb-1">ü•¨</div>
                    <div class="text-xs font-medium">Espinaca</div>
                </div>
                <div class="extra-item bg-red-100 p-2 rounded-lg text-center cursor-pointer hover:bg-red-200" onclick="toggleExtra('betabel')">
                    <div class="text-xl mb-1">üü£</div>
                    <div class="text-xs font-medium">Betabel</div>
                </div>
            </div>
            
            <!-- Nombre tu estilo -->
            <div class="mt-4 p-3 bg-gradient-to-r from-purple-100 to-pink-100 rounded-lg border-2 border-dashed border-purple-300">
                <h4 class="text-lg font-bold text-purple-800 mb-2">‚ú® ¬°Ponle nombre a tu estilo!</h4>
                <p class="text-sm text-purple-700 mb-2">Si nos gusta mucho podr√≠a aparecer en el men√∫</p>
                <input type="text" id="custom-name" placeholder="Ej: El S√∫per Verde de Mar√≠a" class="w-full p-2 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm">
            </div>
        </div>

        <!-- Opciones de Preparaci√≥n -->
        <div class="bg-white rounded-2xl shadow-xl p-4 mb-4">
            <h3 class="text-xl font-bold mb-3 text-gray-800">ü•§ M√©todo de Preparaci√≥n</h3>
            <div class="grid grid-cols-1 gap-3">
                <div class="prep-option bg-blue-100 p-3 rounded-xl cursor-pointer border-2 border-transparent hover:bg-blue-200 flex items-center gap-3" onclick="selectPrep('frapeado')">
                    <div class="text-2xl">üßä</div>
                    <h4 class="font-bold">Frapeado</h4>
                </div>
                <div class="prep-option bg-green-100 p-3 rounded-xl cursor-pointer border-2 border-transparent hover:bg-green-200 flex items-center gap-3" onclick="selectPrep('natural')">
                    <div class="text-2xl">üåø</div>
                    <h4 class="font-bold">Natural</h4>
                </div>
                <div class="prep-option bg-gray-100 p-3 rounded-xl cursor-pointer border-2 border-transparent hover:bg-gray-200 flex items-center gap-3" onclick="selectPrep('rocas')">
                    <div class="text-2xl">üßä</div>
                    <h4 class="font-bold">En las Rocas</h4>
                </div>
            </div>
        </div>

        <!-- Endulzante -->
        <div class="bg-white rounded-2xl shadow-xl p-4 mb-4">
            <h3 class="text-xl font-bold mb-3 text-gray-800">üçØ Endulzante</h3>
            <div class="grid grid-cols-2 gap-3">
                <div class="sweet-option bg-yellow-100 p-3 rounded-xl cursor-pointer border-2 border-transparent hover:bg-yellow-200" onclick="selectSweet('azucar')">
                    <div class="text-xl mb-1 text-center">üçØ</div>
                    <h4 class="font-bold text-center text-sm">Az√∫car</h4>
                </div>
                <div class="sweet-option bg-green-100 p-3 rounded-xl cursor-pointer border-2 border-transparent hover:bg-green-200" onclick="selectSweet('stevia')">
                    <div class="text-xl mb-1 text-center">üåø</div>
                    <h4 class="font-bold text-center text-sm">Stevia</h4>
                </div>
                <div class="sweet-option bg-amber-100 p-3 rounded-xl cursor-pointer border-2 border-transparent hover:bg-amber-200" onclick="selectSweet('miel')">
                    <div class="text-xl mb-1 text-center">üçØ</div>
                    <h4 class="font-bold text-center text-sm">Miel Natural</h4>
                </div>
                <div class="sweet-option bg-gray-100 p-3 rounded-xl cursor-pointer border-2 border-transparent hover:bg-gray-200" onclick="selectSweet('sin')">
                    <div class="text-xl mb-1 text-center">üö´</div>
                    <h4 class="font-bold text-center text-sm">Sin Az√∫car</h4>
                </div>
            </div>
        </div>

        <!-- Tama√±o -->
        <div class="bg-white rounded-2xl shadow-xl p-4 mb-4">
            <h3 class="text-xl font-bold mb-3 text-gray-800">Tama√±o</h3>
            <div class="grid grid-cols-1 gap-3">
                <div class="size-option bg-blue-100 p-4 rounded-xl cursor-pointer border-2 border-transparent hover:bg-blue-200 flex items-center gap-3" onclick="selectSize('16oz')">
                    <div class="text-3xl">ü•§</div>
                    <div class="flex-1">
                        <h4 class="font-bold">16oz - Chico</h4>
                    </div>
                </div>
                <div class="size-option bg-purple-100 p-4 rounded-xl cursor-pointer border-2 border-transparent hover:bg-purple-200 flex items-center gap-3" onclick="selectSize('24oz')">
                    <div class="text-3xl">ü•§</div>
                    <div class="flex-1">
                        <h4 class="font-bold">24oz - Grande</h4>
                         <p class="text-sm text-gray-600">+$10 MXN</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bot√≥n Agregar al Carrito -->
        <div id="add-to-cart-section" class="hidden mb-4">
            <div class="flex gap-2">
                <button id="add-to-cart-btn" onclick="addToCartAndPrompt()" class="flex-1 w-full bg-gradient-to-r from-green-500 to-orange-500 text-white font-bold py-4 px-6 rounded-xl hover:from-green-600 hover:to-orange-600 transition-colors shadow-lg text-lg">
                    üõí Agregar al Carrito
                </button>
                <button id="schedule-juice-btn" onclick="showScheduleModalForJuice()" class="w-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-6 rounded-xl transition-colors shadow-lg text-lg">
                    üìÖ Programar Pedido
                </button>
            </div>
        </div>

        <!-- M√©todo de Entrega -->
        <div id="delivery-section" class="bg-white rounded-2xl shadow-xl p-4 mb-4 hidden">
            <h3 class="text-xl font-bold mb-3 text-gray-800">Entrega</h3>
            <div class="grid grid-cols-1 gap-3">
                <div class="delivery-option bg-green-100 p-4 rounded-xl cursor-pointer border-2 border-transparent hover:bg-green-200 flex items-center gap-3" onclick="selectDelivery('tienda')">
                    <div class="text-3xl">üè™</div>
                    <div class="flex-1">
                        <h4 class="font-bold">Recoger en Tienda</h4>
                        <p class="text-sm text-gray-600">Sin costo adicional</p>
                    </div>
                </div>
                <div class="delivery-option bg-orange-100 p-4 rounded-xl cursor-pointer border-2 border-transparent hover:bg-orange-200 flex items-center gap-3" onclick="selectDelivery('domicilio')">
                    <div class="text-3xl">üöó</div>
                    <div class="flex-1">
                        <h4 class="font-bold">Env√≠o a Domicilio</h4>
                        <p class="text-sm text-gray-600">Costo de env√≠o puede variar</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- M√©todo de Pago -->
        <div id="payment-section" class="bg-white rounded-2xl shadow-xl p-4 mb-4 hidden">
            <h3 class="text-xl font-bold mb-3 text-gray-800">M√©todo de Pago</h3>
            <div class="grid grid-cols-1 gap-3">
                <div class="payment-option bg-green-100 p-4 rounded-xl cursor-pointer border-2 border-transparent hover:bg-green-200 flex items-center gap-3" onclick="selectPayment('efectivo')">
                    <div class="text-3xl">üíµ</div>
                    <h4 class="font-bold">Efectivo</h4>
                </div>
                <div class="payment-option bg-blue-100 p-4 rounded-xl cursor-pointer border-2 border-transparent hover:bg-blue-200 flex items-center gap-3" onclick="selectPayment('transferencia')">
                    <div class="text-3xl">üí≥</div>
                    <h4 class="font-bold">Transferencia HSBC</h4>
                </div>
            </div>
        </div>

        <!-- Datos de Domicilio -->
        <div id="delivery-form" class="bg-white rounded-2xl shadow-xl p-4 mb-4 hidden">
            <h3 class="text-xl font-bold mb-3 text-gray-800">Datos de Entrega</h3>
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Colonia</label>
                    <input type="text" id="colonia" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" oninput="checkAndEnableWhatsapp()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Calle</label>
                    <input type="text" id="calle" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" oninput="checkAndEnableWhatsapp()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">N√∫mero Exterior</label>
                    <input type="text" id="numero" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" oninput="checkAndEnableWhatsapp()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Privada (opcional)</label>
                    <input type="text" id="privada" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">C√≥digo de Acceso (opcional)</label>
                    <input type="text" id="codigo" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Tel√©fono</label>
                    <input type="tel" id="telefono" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" oninput="checkAndEnableWhatsapp()">
                </div>
            </div>
        </div>

        <!-- Resumen del Pedido Final -->
        <div id="order-summary" class="bg-gradient-to-r from-green-500 to-orange-500 text-white rounded-2xl shadow-xl p-4 mb-4 hidden">
            <h3 class="text-xl font-bold mb-3">Tu Pedido</h3>
            <div class="flex items-center gap-4 mb-3">
                <div id="juice-image" class="text-6xl">üõí</div>
                <div id="order-details" class="space-y-1 flex-1 text-sm"></div>
            </div>
            <div id="total-price" class="text-lg font-bold mb-3 bg-white bg-opacity-20 p-3 rounded-lg"></div>
            <button id="whatsapp-btn" onclick="sendWhatsApp()" class="w-full bg-white text-green-600 font-bold py-3 px-4 rounded-xl hover:bg-gray-100 transition-colors pulse-animation text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                Enviar Pedido por WhatsApp
            </button>
        </div>

    </div>

    <script>
        let currentOrder = {
            juice: '',
            extras: [],
            preparation: '',
            sweetener: '',
            size: ''
        };
        let cart = [];
        let selectedDelivery = null;
        let selectedPayment = null;
        
        const juicePrices = {
            'verde': 55,
            'naranja': 55,
            'mango': 60,
            'berries': 65,
            'fresa': 60,
            'personalizado': 60
        };

        const juiceNames = {
            'verde': 'Green Day',
            'naranja': 'AC/DCitrus',
            'mango': 'Mango Van Gogh',
            'berries': 'Berryonc√©',
            'fresa': 'Adeleicious',
            'personalizado': 'Jugo Personalizado'
        };

        const juiceImages = {
            'verde': 'ü•¨',
            'naranja': 'üçä',
            'mango': 'ü•≠',
            'berries': 'üçá',
            'fresa': 'üçì',
            'personalizado': 'üé®'
        };
        
        function showModal(icon, text) {
            document.getElementById('modal-icon').innerHTML = icon;
            document.getElementById('modal-text').textContent = text;
            document.getElementById('message-modal').classList.remove('hidden');
        }

        function hideModal() {
            document.getElementById('message-modal').classList.add('hidden');
        }

        function resetJuiceSelection() {
            currentOrder = {
                juice: '',
                extras: [],
                preparation: '',
                sweetener: '',
                size: ''
            };
            document.querySelectorAll('.juice-card, .prep-option, .sweet-option, .size-option').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelectorAll('.extra-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.getElementById('extras-section').classList.add('hidden');
            document.getElementById('add-to-cart-section').classList.add('hidden');
            document.getElementById('custom-name').value = '';
        }

        function updateCartCount() {
            document.getElementById('cart-count').textContent = cart.length;
        }

        function selectJuice(juice) {
            document.querySelectorAll('.juice-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.juice-card').classList.add('selected');
            currentOrder.juice = juice;
            
            if (juice === 'personalizado') {
                document.getElementById('extras-section').classList.remove('hidden');
                setTimeout(() => {
                    const extrasSection = document.getElementById('extras-section');
                    if (extrasSection) {
                        extrasSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            } else {
                document.getElementById('extras-section').classList.add('hidden');
                currentOrder.extras = [];
                document.querySelectorAll('.extra-item').forEach(item => {
                    item.classList.remove('selected');
                });
                setTimeout(() => {
                    const sections = document.querySelectorAll('.bg-white.rounded-2xl.shadow-xl');
                    const prepSection = Array.from(sections).find(section => section.querySelector('h3') && section.querySelector('h3').textContent.includes('M√©todo de Preparaci√≥n'));
                    if (prepSection) {
                        prepSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            }
            showAddToCartButton();
        }

        function showAddToCartButton() {
            if (currentOrder.juice && currentOrder.preparation && currentOrder.sweetener && currentOrder.size) {
                document.getElementById('add-to-cart-section').classList.remove('hidden');
            } else {
                document.getElementById('add-to-cart-section').classList.add('hidden');
            }
        }

        function toggleExtra(extra) {
            const extraElement = event.target.closest('.extra-item');
            
            if (currentOrder.extras.includes(extra)) {
                currentOrder.extras = currentOrder.extras.filter(e => e !== extra);
                extraElement.classList.remove('selected');
            } else {
                currentOrder.extras.push(extra);
                extraElement.classList.add('selected');
            }
        }

        function selectPrep(prep) {
            document.querySelectorAll('.prep-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.prep-option').classList.add('selected');
            currentOrder.preparation = prep;
            setTimeout(() => {
                const sections = document.querySelectorAll('.bg-white.rounded-2xl.shadow-xl');
                const sweetSection = Array.from(sections).find(section => section.querySelector('h3') && section.querySelector('h3').textContent.includes('Endulzante'));
                if (sweetSection) {
                    sweetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
            showAddToCartButton();
        }

        function selectSweet(sweet) {
            document.querySelectorAll('.sweet-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.sweet-option').classList.add('selected');
            currentOrder.sweetener = sweet;
            setTimeout(() => {
                const sections = document.querySelectorAll('.bg-white.rounded-2xl.shadow-xl');
                const sizeSection = Array.from(sections).find(section => section.querySelector('h3') && section.querySelector('h3').textContent.includes('Tama√±o'));
                if (sizeSection) {
                    sizeSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
            showAddToCartButton();
        }

        function selectSize(size) {
            document.querySelectorAll('.size-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.size-option').classList.add('selected');
            currentOrder.size = size;
            showAddToCartButton();
        }
        
        function selectDelivery(delivery) {
            document.querySelectorAll('.delivery-option').forEach(option => option.classList.remove('selected'));
            event.target.closest('.delivery-option').classList.add('selected');
            selectedDelivery = delivery;
            
            if (delivery === 'domicilio') {
                document.getElementById('delivery-form').classList.remove('hidden');
                // No scroll here to avoid jumping. The user will scroll naturally.
            } else {
                document.getElementById('delivery-form').classList.add('hidden');
            }
            updateCartDisplay();
            showFinalOrderSummary();
        }

        function selectPayment(payment) {
            document.querySelectorAll('.payment-option').forEach(option => option.classList.remove('selected'));
            event.target.closest('.payment-option').classList.add('selected');
            selectedPayment = payment;
            updateCartDisplay();
            showFinalOrderSummary();
        }

        function addToCartAndPrompt() {
            if (!currentOrder.juice || !currentOrder.preparation || !currentOrder.sweetener || !currentOrder.size) {
                showModal('‚ö†Ô∏è', 'Por favor, completa todas las opciones antes de agregar al carrito.');
                return;
            }

            let price = juicePrices[currentOrder.juice] || 60;
            if (currentOrder.size === '24oz') {
                price += 10;
            }
            if (currentOrder.extras.length > 3) {
                price += (currentOrder.extras.length - 3) * 5;
            }

            const customName = document.getElementById('custom-name') ? document.getElementById('custom-name').value.trim() : '';
            const cartItem = {
                id: Date.now(),
                juice: currentOrder.juice,
                name: juiceNames[currentOrder.juice],
                customName: customName,
                extras: [...currentOrder.extras],
                preparation: currentOrder.preparation,
                sweetener: currentOrder.sweetener,
                size: currentOrder.size,
                price: price
            };

            cart.push(cartItem);
            updateCartCount();
            
            const addBtn = document.getElementById('add-to-cart-btn');
            const originalText = addBtn.innerHTML;
            addBtn.innerHTML = '‚úÖ ¬°Agregado al carrito!';
            addBtn.classList.add('bg-green-500');
            setTimeout(() => {
                addBtn.innerHTML = originalText;
                addBtn.classList.remove('bg-green-500');
                document.getElementById('add-more-modal').classList.remove('hidden');
            }, 1000);
        }

        function addAnotherJuice() {
            document.getElementById('add-more-modal').classList.add('hidden');
            resetJuiceSelection();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function proceedToFinalCheckout() {
            document.getElementById('add-more-modal').classList.add('hidden');
            resetJuiceSelection();
            
            document.getElementById('delivery-section').classList.remove('hidden');
            document.getElementById('payment-section').classList.remove('hidden');
            
            setTimeout(() => {
                const deliverySection = document.getElementById('delivery-section');
                if (deliverySection) {
                    deliverySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        function checkAndEnableWhatsapp() {
            showFinalOrderSummary();
        }
        
        function sendWhatsApp() {
            let message = `üçπ ¬°Hola! Quiero hacer un pedido de FruitBox\n\n`;
            
            if (cart.length === 0) {
                showModal('‚ö†Ô∏è', 'Tu carrito est√° vac√≠o. Por favor, agrega un jugo para continuar.');
                return;
            }

            let subtotal = 0;
            message += `üõí MI PEDIDO (${cart.length} productos):\n\n`;
            
            cart.forEach((item, index) => {
                subtotal += item.price;
                message += `${index + 1}. ${item.name}\n`;
                if (item.customName) {
                    message += `   ‚ú® "${item.customName}"\n`;
                }
                message += `   üìè Tama√±o: ${item.size === '16oz' ? '16 oz (Chico)' : '24 oz (Grande)'}\n`;
                message += `   ü•§ Preparaci√≥n: ${item.preparation}\n`;
                message += `   üçØ Endulzante: ${item.sweetener}\n`;
                if (item.extras.length > 0) {
                    message += `   üåà Extras: ${item.extras.join(', ')}\n`;
                }
                message += `   üí∞ Precio: $${item.price} MXN\n\n`;
            });
            
            let finalTotal = subtotal;
            
            message += `üí∞ RESUMEN:\n`;
            message += `   Subtotal: $${subtotal} MXN\n`;
            
            if (selectedDelivery === 'domicilio') {
                message += `   Env√≠o: Puede variar de acuerdo a la ubicaci√≥n\n`;
                message += `   üéØ TOTAL: Pendiente de confirmaci√≥n\n\n`;
            } else { // 'tienda'
                message += `   Env√≠o: $0 MXN\n`;
                message += `   üéØ TOTAL: $${finalTotal} MXN\n\n`;
            }
            
            if (!selectedPayment) {
                 showModal('‚ö†Ô∏è', 'Por favor, selecciona un m√©todo de pago.');
                 return;
            }
            message += `üí≥ M√©todo de pago: ${selectedPayment === 'efectivo' ? 'Efectivo' : 'Transferencia HSBC'}\n\n`;
            
            // --- Se ha corregido la l√≥gica para la informaci√≥n de env√≠o. ---
            if (selectedDelivery === 'domicilio') {
                const colonia = document.getElementById('colonia').value;
                const calle = document.getElementById('calle').value;
                const numero = document.getElementById('numero').value;
                const privada = document.getElementById('privada').value;
                const codigo = document.getElementById('codigo').value;
                const telefono = document.getElementById('telefono').value;

                if (!colonia || !calle || !numero || !telefono) {
                    showModal('‚ö†Ô∏è', 'Por favor, complete los datos de domicilio.');
                    return;
                }

                message += `üöó ENV√çO A DOMICILIO:\n`;
                message += `üèòÔ∏è Colonia: ${colonia}\n`;
                message += `üõ£Ô∏è Calle: ${calle}\n`;
                message += `üè† N√∫mero exterior: ${numero}\n`;
                if (privada) message += `üèòÔ∏è Privada: ${privada}\n`;
                if (codigo) message += `üîë C√≥digo de acceso: ${codigo}\n`;
                message += `üì± Tel√©fono: ${telefono}\n\n`;

                if (selectedPayment === 'transferencia') {
                    message += `üí≥ INFORMACI√ìN PARA TRANSFERENCIA:\n`;
                    message += `üè¶ Banco: HSBC\n`;
                    message += `üë§ Titular: Alan Stephen Vega Chacon\n`;
                    message += `üí∞ Monto a transferir: $${finalTotal} MXN\n\n`;
                    message += `üìÑ Por favor env√≠a el comprobante de transferencia para confirmar tu pedido.\n\n`;
                }
            } else { // 'tienda'
                message += `üè™ RECOGER EN TIENDA:\n\n`;
                message += `üìç Direcci√≥n del negocio:\n`;
                message += `üõ£Ô∏è Calle: Saavedra\n`;
                message += `üè† N√∫mero exterior: 1213\n`;
                message += `üèòÔ∏è Privada: Benavente\n`;
                message += `üîë C√≥digo de acceso: 297822#\n`;
                message += `üè° Detalles: Casa caf√© con blanco cerco de malla\n\n`;
                message += `‚ö†Ô∏è Nota: No olvide mostrar una identificaci√≥n oficial para su ingreso.\n\n`;
            }

            message += `üçπ‚ú® ¬°Tu jugo, tu estilo, tu fruitbox! ‚ú®üçπ`;

            const whatsappUrl = `https://wa.me/526862442310?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        function showScheduleModalForJuice() {
            if (!currentOrder.juice || !currentOrder.preparation || !currentOrder.sweetener || !currentOrder.size) {
                showModal('‚ö†Ô∏è', 'Por favor, completa todas las opciones del jugo antes de programar el pedido.');
                return;
            }
            document.getElementById('schedule-modal').classList.remove('hidden');
        }
        
        function hideScheduleModal() {
            document.getElementById('schedule-modal').classList.add('hidden');
        }
        
        function sendScheduledJuiceWhatsApp() {
            const scheduleDate = document.getElementById('scheduled-date').value;
            const scheduleTime = document.getElementById('scheduled-time').value;
            const scheduleNotes = document.getElementById('scheduled-notes').value.trim();
            
            if (!scheduleDate || !scheduleTime) {
                showModal('‚ö†Ô∏è', 'Por favor, selecciona una fecha y hora para programar tu pedido.');
                return;
            }

            let price = juicePrices[currentOrder.juice] || 60;
            if (currentOrder.size === '24oz') {
                price += 10;
            }
            if (currentOrder.extras.length > 3) {
                price += (currentOrder.extras.length - 3) * 5;
            }

            let message = `üìÖ ¬°Hola! Me gustar√≠a programar un pedido de FruitBox para el futuro.\n\n`;
            message += `üóìÔ∏è **Fecha Programada:** ${scheduleDate}\n`;
            message += `‚è∞ **Hora Programada:** ${scheduleTime}\n\n`;
            
            if (scheduleNotes) {
                message += `üìù **Notas:** ${scheduleNotes}\n\n`;
            }

            message += `ü•§ **DETALLES DEL JUGO:**\n`;
            message += `   Nombre: ${juiceNames[currentOrder.juice]}\n`;
            const customName = document.getElementById('custom-name').value.trim();
            if (currentOrder.juice === 'personalizado' && customName) {
                message += `   Creaci√≥n: "${customName}"\n`;
            }
            message += `   Tama√±o: ${currentOrder.size === '16oz' ? '16 oz (Chico)' : '24 oz (Grande)'}\n`;
            message += `   Preparaci√≥n: ${currentOrder.preparation}\n`;
            message += `   Endulzante: ${currentOrder.sweetener}\n`;
            if (currentOrder.extras.length > 0) {
                message += `   Extras: ${currentOrder.extras.join(', ')}\n`;
            }
            message += `   Precio estimado: $${price} MXN\n\n`;

            message += `üè™ **INFORMACI√ìN DE RECOGIDA:**\n`;
            message += `Recoger√© mi pedido en la tienda. Favor de tenerlo listo a la hora indicada.\n`;
            message += `üìç Direcci√≥n: Saavedra 1213, Privada Benavente\n`;
            message += `‚ö†Ô∏è Nota: No olvide mostrar una identificaci√≥n oficial para su ingreso.\n\n`;

            message += `üçπ‚ú® ¬°Gracias! ‚ú®üçπ`;

            const whatsappUrl = `https://wa.me/526862442310?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            hideScheduleModal();
            resetJuiceSelection();
        }

        function updateCartDisplay() {
            document.getElementById('cart-count').textContent = cart.length;
            
            const cartItems = document.getElementById('cart-items');
            const cartSummary = document.getElementById('cart-summary');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<div id="empty-cart" class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">üõí</div><p>Tu carrito est√° vac√≠o</p><p class="text-sm">¬°Agrega algunos jugos deliciosos!</p></div>';
                cartSummary.classList.add('hidden');
            } else {
                cartSummary.classList.remove('hidden');
                
                let cartHTML = '';
                let subtotal = 0;
                
                cart.forEach(item => {
                    const itemTotal = item.price;
                    subtotal += itemTotal;
                    
                    cartHTML += `
                        <div class="border-b border-gray-200 pb-4 mb-4 last:border-b-0">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex-1 pr-2">
                                    <h4 class="font-bold text-gray-800 mb-1">${item.name}</h4>
                                    ${item.customName ? `<p class="text-xs text-purple-600 italic font-medium mb-1">‚ú® "${item.customName}"</p>` : ''}
                                    <div class="text-xs text-gray-600 space-y-1">
                                        <p>üìè Tama√±o: ${item.size === '16oz' ? '16oz (Chico)' : '24oz (Grande)'}</p>
                                        <p>ü•§ Preparaci√≥n: ${item.preparation}</p>
                                        <p>üçØ Endulzante: ${item.sweetener}</p>
                                        ${item.extras.length > 0 ? `<p>üåà Extras: ${item.extras.join(', ')}</p>` : ''}
                                    </div>
                                </div>
                                <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 p-1">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="flex justify-between items-center bg-gray-50 p-2 rounded-lg">
                                <div class="flex items-center gap-2">
                                    <span class="text-sm font-bold min-w-[20px] text-center">1</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-green-600">$${itemTotal}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                cartItems.innerHTML = cartHTML;
                
                let shippingText = 'Puede variar de acuerdo a la ubicaci√≥n';
                let total = subtotal;
                
                if (selectedDelivery === 'tienda') {
                     shippingText = '$0';
                     total = subtotal;
                }
                
                document.getElementById('cart-subtotal').textContent = `$${subtotal}`;
                document.getElementById('cart-shipping').innerHTML = shippingText;
                document.getElementById('cart-total').textContent = `$${total}`;
            }
        }

        function removeFromCart(itemId) {
            cart = cart.filter(item => item.id !== itemId);
            updateCartCount();
            updateCartDisplay();
        }

        function toggleCart() {
            const cartModal = document.getElementById('cart-modal');
            cartModal.classList.toggle('hidden');
            if (!cartModal.classList.contains('hidden')) {
                updateCartDisplay();
            }
        }

        function proceedToCheckout() {
            if (cart.length === 0) {
                showModal('‚ö†Ô∏è', 'Tu carrito est√° vac√≠o. Por favor, agrega un jugo para continuar.');
                return;
            }
            toggleCart();
            document.getElementById('delivery-section').classList.remove('hidden');
            document.getElementById('payment-section').classList.remove('hidden');
            document.getElementById('order-summary').classList.add('hidden');
            setTimeout(() => {
                const deliverySection = document.getElementById('delivery-section');
                if (deliverySection) {
                    deliverySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        function showFinalOrderSummary() {
            if (!selectedDelivery || !selectedPayment) {
                 return;
            }

            const summary = document.getElementById('order-summary');
            const details = document.getElementById('order-details');
            const totalPrice = document.getElementById('total-price');
            const whatsappBtn = document.getElementById('whatsapp-btn');
            
            let subtotal = cart.reduce((total, item) => total + item.price, 0);
            
            let orderText = `<div class="font-bold mb-2">üõí Resumen del Carrito (${cart.length} productos)</div>`;
            
            cart.forEach((item, index) => {
                orderText += `<div class="text-xs mb-2 bg-white bg-opacity-20 p-2 rounded">`;
                orderText += `<div class="font-medium">${index + 1}. ${item.name}`;
                if (item.customName) {
                    orderText += ` - "${item.customName}"`;
                }
                orderText += `</div>`;
                orderText += `<div>Tama√±o: ${item.size === '16oz' ? '16oz (Chico)' : '24oz (Grande)'}</div>`;
                if (item.extras.length > 0) {
                    orderText += `<div>Extras: ${item.extras.join(', ')}</div>`;
                }
                orderText += `<div>Preparaci√≥n: ${item.preparation} | Endulzante: ${item.sweetener}</div>`;
                orderText += `<div class="font-medium">Precio: $${item.price} MXN</div>`;
                orderText += `</div>`;
            });
            
            orderText += `<div class="mt-2 pt-2 border-t border-white border-opacity-30">`;
            orderText += `<div>üì¶ Entrega: ${selectedDelivery === 'tienda' ? 'Recoger en tienda' : 'Env√≠o a domicilio'}</div>`;
            orderText += `<div>üí≥ Pago: ${selectedPayment === 'efectivo' ? 'Efectivo' : 'Transferencia HSBC'}</div>`;
            orderText += `</div>`;
            
            details.innerHTML = orderText;

            if (selectedDelivery === 'domicilio') {
                 // No mostrar total fijo, ya que el costo de env√≠o es variable
                totalPrice.innerHTML = `Subtotal: $${subtotal} + Env√≠o: Puede variar = Total: Pendiente de confirmaci√≥n`;
            } else { // 'tienda'
                totalPrice.innerHTML = `Subtotal: $${subtotal} + Env√≠o: $0 = Total: $${subtotal} MXN`;
            }

            // L√≥gica para habilitar/deshabilitar el bot√≥n de WhatsApp
            const colonia = document.getElementById('colonia').value.trim();
            const calle = document.getElementById('calle').value.trim();
            const numero = document.getElementById('numero').value.trim();
            const telefono = document.getElementById('telefono').value.trim();

            if (selectedDelivery === 'domicilio' && (!colonia || !calle || !numero || !telefono)) {
                whatsappBtn.disabled = true;
                whatsappBtn.classList.add('opacity-50', 'cursor-not-allowed');
                whatsappBtn.innerHTML = 'Complete los datos de domicilio';
            } else {
                whatsappBtn.disabled = false;
                whatsappBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                whatsappBtn.innerHTML = 'Enviar Pedido por WhatsApp';
            }

            summary.classList.remove('hidden');
        }

        function checkAndEnableWhatsapp() {
            showFinalOrderSummary();
        }
        
        function sendWhatsApp() {
            let message = `üçπ ¬°Hola! Quiero hacer un pedido de FruitBox\n\n`;
            
            if (cart.length === 0) {
                showModal('‚ö†Ô∏è', 'Tu carrito est√° vac√≠o. Por favor, agrega un jugo para continuar.');
                return;
            }

            let subtotal = 0;
            message += `üõí MI PEDIDO (${cart.length} productos):\n\n`;
            
            cart.forEach((item, index) => {
                subtotal += item.price;
                message += `${index + 1}. ${item.name}\n`;
                if (item.customName) {
                    message += `   ‚ú® "${item.customName}"\n`;
                }
                message += `   üìè Tama√±o: ${item.size === '16oz' ? '16 oz (Chico)' : '24 oz (Grande)'}\n`;
                message += `   ü•§ Preparaci√≥n: ${item.preparation}\n`;
                message += `   üçØ Endulzante: ${item.sweetener}\n`;
                if (item.extras.length > 0) {
                    message += `   üåà Extras: ${item.extras.join(', ')}\n`;
                }
                message += `   üí∞ Precio: $${item.price} MXN\n\n`;
            });
            
            let finalTotal = subtotal;
            
            message += `üí∞ RESUMEN:\n`;
            message += `   Subtotal: $${subtotal} MXN\n`;
            
            if (selectedDelivery === 'domicilio') {
                message += `   Env√≠o: Puede variar de acuerdo a la ubicaci√≥n\n`;
                message += `   üéØ TOTAL: Pendiente de confirmaci√≥n\n\n`;
            } else { // 'tienda'
                message += `   Env√≠o: $0 MXN\n`;
                message += `   üéØ TOTAL: $${finalTotal} MXN\n\n`;
            }
            
            if (!selectedPayment) {
                 showModal('‚ö†Ô∏è', 'Por favor, selecciona un m√©todo de pago.');
                 return;
            }
            message += `üí≥ M√©todo de pago: ${selectedPayment === 'efectivo' ? 'Efectivo' : 'Transferencia HSBC'}\n\n`;
            
            // --- Se ha corregido la l√≥gica para la informaci√≥n de env√≠o. ---
            if (selectedDelivery === 'domicilio') {
                const colonia = document.getElementById('colonia').value;
                const calle = document.getElementById('calle').value;
                const numero = document.getElementById('numero').value;
                const privada = document.getElementById('privada').value;
                const codigo = document.getElementById('codigo').value;
                const telefono = document.getElementById('telefono').value;

                if (!colonia || !calle || !numero || !telefono) {
                    showModal('‚ö†Ô∏è', 'Por favor, complete los datos de domicilio.');
                    return;
                }

                message += `üöó ENV√çO A DOMICILIO:\n`;
                message += `üèòÔ∏è Colonia: ${colonia}\n`;
                message += `üõ£Ô∏è Calle: ${calle}\n`;
                message += `üè† N√∫mero exterior: ${numero}\n`;
                if (privada) message += `üèòÔ∏è Privada: ${privada}\n`;
                if (codigo) message += `üîë C√≥digo de acceso: ${codigo}\n`;
                message += `üì± Tel√©fono: ${telefono}\n\n`;

                if (selectedPayment === 'transferencia') {
                    message += `üí≥ INFORMACI√ìN PARA TRANSFERENCIA:\n`;
                    message += `üè¶ Banco: HSBC\n`;
                    message += `üë§ Titular: Alan Stephen Vega Chacon\n`;
                    message += `üí∞ Monto a transferir: $${finalTotal} MXN\n\n`;
                    message += `üìÑ Por favor env√≠a el comprobante de transferencia para confirmar tu pedido.\n\n`;
                }
            } else if (selectedDelivery === 'tienda') { // La l√≥gica de `else if` es m√°s segura
                message += `üè™ RECOGER EN TIENDA:\n\n`;
                message += `üìç Direcci√≥n del negocio:\n`;
                message += `üõ£Ô∏è Calle: Saavedra\n`;
                message += `üè† N√∫mero exterior: 1213\n`;
                message += `üèòÔ∏è Privada: Benavente\n`;
                message += `üîë C√≥digo de acceso: 297822#\n`;
                message += `üè° Detalles: Casa caf√© con blanco cerco de malla\n\n`;
                message += `‚ö†Ô∏è Nota: No olvide mostrar una identificaci√≥n oficial para su ingreso.\n\n`;
            }

            message += `üçπ‚ú® ¬°Tu jugo, tu estilo, tu fruitbox! ‚ú®üçπ`;

            const whatsappUrl = `https://wa.me/526862442310?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        function showScheduleModalForJuice() {
            if (!currentOrder.juice || !currentOrder.preparation || !currentOrder.sweetener || !currentOrder.size) {
                showModal('‚ö†Ô∏è', 'Por favor, completa todas las opciones del jugo antes de programar el pedido.');
                return;
            }
            document.getElementById('schedule-modal').classList.remove('hidden');
        }
        
        function hideScheduleModal() {
            document.getElementById('schedule-modal').classList.add('hidden');
        }
        
        function sendScheduledJuiceWhatsApp() {
            const scheduleDate = document.getElementById('scheduled-date').value;
            const scheduleTime = document.getElementById('scheduled-time').value;
            const scheduleNotes = document.getElementById('scheduled-notes').value.trim();
            
            if (!scheduleDate || !scheduleTime) {
                showModal('‚ö†Ô∏è', 'Por favor, selecciona una fecha y hora para programar tu pedido.');
                return;
            }

            let price = juicePrices[currentOrder.juice] || 60;
            if (currentOrder.size === '24oz') {
                price += 10;
            }
            if (currentOrder.extras.length > 3) {
                price += (currentOrder.extras.length - 3) * 5;
            }

            let message = `üìÖ ¬°Hola! Me gustar√≠a programar un pedido de FruitBox para el futuro.\n\n`;
            message += `üóìÔ∏è **Fecha Programada:** ${scheduleDate}\n`;
            message += `‚è∞ **Hora Programada:** ${scheduleTime}\n\n`;
            
            if (scheduleNotes) {
                message += `üìù **Notas:** ${scheduleNotes}\n\n`;
            }

            message += `ü•§ **DETALLES DEL JUGO:**\n`;
            message += `   Nombre: ${juiceNames[currentOrder.juice]}\n`;
            const customName = document.getElementById('custom-name').value.trim();
            if (currentOrder.juice === 'personalizado' && customName) {
                message += `   Creaci√≥n: "${customName}"\n`;
            }
            message += `   Tama√±o: ${currentOrder.size === '16oz' ? '16 oz (Chico)' : '24 oz (Grande)'}\n`;
            message += `   Preparaci√≥n: ${currentOrder.preparation}\n`;
            message += `   Endulzante: ${currentOrder.sweetener}\n`;
            if (currentOrder.extras.length > 0) {
                message += `   Extras: ${currentOrder.extras.join(', ')}\n`;
            }
            message += `   Precio estimado: $${price} MXN\n\n`;

            message += `üè™ **INFORMACI√ìN DE RECOGIDA:**\n`;
            message += `Recoger√© mi pedido en la tienda. Favor de tenerlo listo a la hora indicada.\n`;
            message += `üìç Direcci√≥n: Saavedra 1213, Privada Benavente\n`;
            message += `‚ö†Ô∏è Nota: No olvide mostrar una identificaci√≥n oficial para su ingreso.\n\n`;

            message += `üçπ‚ú® ¬°Gracias! ‚ú®üçπ`;

            const whatsappUrl = `https://wa.me/526862442310?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            hideScheduleModal();
            resetJuiceSelection();
        }

        function updateCartDisplay() {
            document.getElementById('cart-count').textContent = cart.length;
            
            const cartItems = document.getElementById('cart-items');
            const cartSummary = document.getElementById('cart-summary');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<div id="empty-cart" class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">üõí</div><p>Tu carrito est√° vac√≠o</p><p class="text-sm">¬°Agrega algunos jugos deliciosos!</p></div>';
                cartSummary.classList.add('hidden');
            } else {
                cartSummary.classList.remove('hidden');
                
                let cartHTML = '';
                let subtotal = 0;
                
                cart.forEach(item => {
                    const itemTotal = item.price;
                    subtotal += itemTotal;
                    
                    cartHTML += `
                        <div class="border-b border-gray-200 pb-4 mb-4 last:border-b-0">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex-1 pr-2">
                                    <h4 class="font-bold text-gray-800 mb-1">${item.name}</h4>
                                    ${item.customName ? `<p class="text-xs text-purple-600 italic font-medium mb-1">‚ú® "${item.customName}"</p>` : ''}
                                    <div class="text-xs text-gray-600 space-y-1">
                                        <p>üìè Tama√±o: ${item.size === '16oz' ? '16oz (Chico)' : '24oz (Grande)'}</p>
                                        <p>ü•§ Preparaci√≥n: ${item.preparation}</p>
                                        <p>üçØ Endulzante: ${item.sweetener}</p>
                                        ${item.extras.length > 0 ? `<p>üåà Extras: ${item.extras.join(', ')}</p>` : ''}
                                    </div>
                                </div>
                                <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 p-1">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="flex justify-between items-center bg-gray-50 p-2 rounded-lg">
                                <div class="flex items-center gap-2">
                                    <span class="text-sm font-bold min-w-[20px] text-center">1</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-green-600">$${itemTotal}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                cartItems.innerHTML = cartHTML;
                
                let shippingText = 'Puede variar de acuerdo a la ubicaci√≥n';
                let total = subtotal;
                
                if (selectedDelivery === 'tienda') {
                     shippingText = '$0';
                     total = subtotal;
                }
                
                document.getElementById('cart-subtotal').textContent = `$${subtotal}`;
                document.getElementById('cart-shipping').innerHTML = shippingText;
                document.getElementById('cart-total').textContent = `$${total}`;
            }
        }

        function removeFromCart(itemId) {
            cart = cart.filter(item => item.id !== itemId);
            updateCartCount();
            updateCartDisplay();
        }

        function toggleCart() {
            const cartModal = document.getElementById('cart-modal');
            cartModal.classList.toggle('hidden');
            if (!cartModal.classList.contains('hidden')) {
                updateCartDisplay();
            }
        }

        function proceedToCheckout() {
            if (cart.length === 0) {
                showModal('‚ö†Ô∏è', 'Tu carrito est√° vac√≠o. Por favor, agrega un jugo para continuar.');
                return;
            }
            toggleCart();
            document.getElementById('delivery-section').classList.remove('hidden');
            document.getElementById('payment-section').classList.remove('hidden');
            document.getElementById('order-summary').classList.add('hidden');
            setTimeout(() => {
                const deliverySection = document.getElementById('delivery-section');
                if (deliverySection) {
                    deliverySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        function showFinalOrderSummary() {
            if (!selectedDelivery || !selectedPayment) {
                 return;
            }

            const summary = document.getElementById('order-summary');
            const details = document.getElementById('order-details');
            const totalPrice = document.getElementById('total-price');
            const whatsappBtn = document.getElementById('whatsapp-btn');
            
            let subtotal = cart.reduce((total, item) => total + item.price, 0);
            
            let orderText = `<div class="font-bold mb-2">üõí Resumen del Carrito (${cart.length} productos)</div>`;
            
            cart.forEach((item, index) => {
                orderText += `<div class="text-xs mb-2 bg-white bg-opacity-20 p-2 rounded">`;
                orderText += `<div class="font-medium">${index + 1}. ${item.name}`;
                if (item.customName) {
                    orderText += ` - "${item.customName}"`;
                }
                orderText += `</div>`;
                orderText += `<div>Tama√±o: ${item.size === '16oz' ? '16oz (Chico)' : '24oz (Grande)'}</div>`;
                if (item.extras.length > 0) {
                    orderText += `<div>Extras: ${item.extras.join(', ')}</div>`;
                }
                orderText += `<div>Preparaci√≥n: ${item.preparation} | Endulzante: ${item.sweetener}</div>`;
                orderText += `<div class="font-medium">Precio: $${item.price} MXN</div>`;
                orderText += `</div>`;
            });
            
            orderText += `<div class="mt-2 pt-2 border-t border-white border-opacity-30">`;
            orderText += `<div>üì¶ Entrega: ${selectedDelivery === 'tienda' ? 'Recoger en tienda' : 'Env√≠o a domicilio'}</div>`;
            orderText += `<div>üí≥ Pago: ${selectedPayment === 'efectivo' ? 'Efectivo' : 'Transferencia HSBC'}</div>`;
            orderText += `</div>`;
            
            details.innerHTML = orderText;

            if (selectedDelivery === 'domicilio') {
                 // No mostrar total fijo, ya que el costo de env√≠o es variable
                totalPrice.innerHTML = `Subtotal: $${subtotal} + Env√≠o: Puede variar = Total: Pendiente de confirmaci√≥n`;
            } else { // 'tienda'
                totalPrice.innerHTML = `Subtotal: $${subtotal} + Env√≠o: $0 = Total: $${subtotal} MXN`;
            }

            // L√≥gica para habilitar/deshabilitar el bot√≥n de WhatsApp
            const colonia = document.getElementById('colonia').value.trim();
            const calle = document.getElementById('calle').value.trim();
            const numero = document.getElementById('numero').value.trim();
            const telefono = document.getElementById('telefono').value.trim();

            if (selectedDelivery === 'domicilio' && (!colonia || !calle || !numero || !telefono)) {
                whatsappBtn.disabled = true;
                whatsappBtn.classList.add('opacity-50', 'cursor-not-allowed');
                whatsappBtn.innerHTML = 'Complete los datos de domicilio';
            } else {
                whatsappBtn.disabled = false;
                whatsappBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                whatsappBtn.innerHTML = 'Enviar Pedido por WhatsApp';
            }

            summary.classList.remove('hidden');
        }

        function checkAndEnableWhatsapp() {
            showFinalOrderSummary();
        }
        
        function sendWhatsApp() {
            let message = `üçπ ¬°Hola! Quiero hacer un pedido de FruitBox\n\n`;
            
            if (cart.length === 0) {
                showModal('‚ö†Ô∏è', 'Tu carrito est√° vac√≠o. Por favor, agrega un jugo para continuar.');
                return;
            }

            let subtotal = 0;
            message += `üõí MI PEDIDO (${cart.length} productos):\n\n`;
            
            cart.forEach((item, index) => {
                subtotal += item.price;
                message += `${index + 1}. ${item.name}\n`;
                if (item.customName) {
                    message += `   ‚ú® "${item.customName}"\n`;
                }
                message += `   üìè Tama√±o: ${item.size === '16oz' ? '16 oz (Chico)' : '24 oz (Grande)'}\n`;
                message += `   ü•§ Preparaci√≥n: ${item.preparation}\n`;
                message += `   üçØ Endulzante: ${item.sweetener}\n`;
                if (item.extras.length > 0) {
                    message += `   üåà Extras: ${item.extras.join(', ')}\n`;
                }
                message += `   üí∞ Precio: $${item.price} MXN\n\n`;
            });
            
            let finalTotal = subtotal;
            
            message += `üí∞ RESUMEN:\n`;
            message += `   Subtotal: $${subtotal} MXN\n`;
            
            if (selectedDelivery === 'domicilio') {
                message += `   Env√≠o: Puede variar de acuerdo a la ubicaci√≥n\n`;
                message += `   üéØ TOTAL: Pendiente de confirmaci√≥n\n\n`;
            } else { // 'tienda'
                message += `   Env√≠o: $0 MXN\n`;
                message += `   üéØ TOTAL: $${finalTotal} MXN\n\n`;
            }
            
            if (!selectedPayment) {
                 showModal('‚ö†Ô∏è', 'Por favor, selecciona un m√©todo de pago.');
                 return;
            }
            message += `üí≥ M√©todo de pago: ${selectedPayment === 'efectivo' ? 'Efectivo' : 'Transferencia HSBC'}\n\n`;
            
            if (selectedDelivery === 'domicilio') {
                const colonia = document.getElementById('colonia').value;
                const calle = document.getElementById('calle').value;
                const numero = document.getElementById('numero').value;
                const privada = document.getElementById('privada').value;
                const codigo = document.getElementById('codigo').value;
                const telefono = document.getElementById('telefono').value;

                if (!colonia || !calle || !numero || !telefono) {
                    showModal('‚ö†Ô∏è', 'Por favor, complete los datos de domicilio.');
                    return;
                }

                message += `üöó ENV√çO A DOMICILIO:\n`;
                message += `üèòÔ∏è Colonia: ${colonia}\n`;
                message += `üõ£Ô∏è Calle: ${calle}\n`;
                message += `üè† N√∫mero exterior: ${numero}\n`;
                if (privada) message += `üèòÔ∏è Privada: ${privada}\n`;
                if (codigo) message += `üîë C√≥digo de acceso: ${codigo}\n`;
                message += `üì± Tel√©fono: ${telefono}\n\n`;

                if (selectedPayment === 'transferencia') {
                    message += `üí≥ INFORMACI√ìN PARA TRANSFERENCIA:\n`;
                    message += `üè¶ Banco: HSBC\n`;
                    message += `üë§ Titular: Alan Stephen Vega Chacon\n`;
                    message += `üí∞ Monto a transferir: $${finalTotal} MXN\n\n`;
                    message += `üìÑ Por favor env√≠a el comprobante de transferencia para confirmar tu pedido.\n\n`;
                }
            } else {
                message += `üè™ RECOGER EN TIENDA:\n\n`;
                message += `üìç Direcci√≥n del negocio:\n`;
                message += `üõ£Ô∏è Calle: Saavedra\n`;
                message += `üè† N√∫mero exterior: 1213\n`;
                message += `üèòÔ∏è Privada: Benavente\n`;
                message += `üîë C√≥digo de acceso: 297822#\n`;
                message += `üè° Detalles: Casa caf√© con blanco cerco de malla\n\n`;
                message += `‚ö†Ô∏è Nota: No olvide mostrar una identificaci√≥n oficial para su ingreso.\n\n`;
            }

            message += `üçπ‚ú® ¬°Tu jugo, tu estilo, tu fruitbox! ‚ú®üçπ`;

            const whatsappUrl = `https://wa.me/526862442310?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        function showScheduleModalForJuice() {
            if (!currentOrder.juice || !currentOrder.preparation || !currentOrder.sweetener || !currentOrder.size) {
                showModal('‚ö†Ô∏è', 'Por favor, completa todas las opciones del jugo antes de programar el pedido.');
                return;
            }
            document.getElementById('schedule-modal').classList.remove('hidden');
        }
        
        function hideScheduleModal() {
            document.getElementById('schedule-modal').classList.add('hidden');
        }
        
        function sendScheduledJuiceWhatsApp() {
            const scheduleDate = document.getElementById('scheduled-date').value;
            const scheduleTime = document.getElementById('scheduled-time').value;
            const scheduleNotes = document.getElementById('scheduled-notes').value.trim();
            
            if (!scheduleDate || !scheduleTime) {
                showModal('‚ö†Ô∏è', 'Por favor, selecciona una fecha y hora para programar tu pedido.');
                return;
            }

            let price = juicePrices[currentOrder.juice] || 60;
            if (currentOrder.size === '24oz') {
                price += 10;
            }
            if (currentOrder.extras.length > 3) {
                price += (currentOrder.extras.length - 3) * 5;
            }

            let message = `üìÖ ¬°Hola! Me gustar√≠a programar un pedido de FruitBox para el futuro.\n\n`;
            message += `üóìÔ∏è **Fecha Programada:** ${scheduleDate}\n`;
            message += `‚è∞ **Hora Programada:** ${scheduleTime}\n\n`;
            
            if (scheduleNotes) {
                message += `üìù **Notas:** ${scheduleNotes}\n\n`;
            }

            message += `ü•§ **DETALLES DEL JUGO:**\n`;
            message += `   Nombre: ${juiceNames[currentOrder.juice]}\n`;
            const customName = document.getElementById('custom-name').value.trim();
            if (currentOrder.juice === 'personalizado' && customName) {
                message += `   Creaci√≥n: "${customName}"\n`;
            }
            message += `   Tama√±o: ${currentOrder.size === '16oz' ? '16 oz (Chico)' : '24 oz (Grande)'}\n`;
            message += `   Preparaci√≥n: ${currentOrder.preparation}\n`;
            message += `   Endulzante: ${currentOrder.sweetener}\n`;
            if (currentOrder.extras.length > 0) {
                message += `   Extras: ${currentOrder.extras.join(', ')}\n`;
            }
            message += `   Precio estimado: $${price} MXN\n\n`;

            message += `üè™ **INFORMACI√ìN DE RECOGIDA:**\n`;
            message += `Recoger√© mi pedido en la tienda. Favor de tenerlo listo a la hora indicada.\n`;
            message += `üìç Direcci√≥n: Saavedra 1213, Privada Benavente\n`;
            message += `‚ö†Ô∏è Nota: No olvide mostrar una identificaci√≥n oficial para su ingreso.\n\n`;

            message += `üçπ‚ú® ¬°Gracias! ‚ú®üçπ`;

            const whatsappUrl = `https://wa.me/526862442310?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            hideScheduleModal();
            resetJuiceSelection();
        }

        function updateCartDisplay() {
            document.getElementById('cart-count').textContent = cart.length;
            
            const cartItems = document.getElementById('cart-items');
            const cartSummary = document.getElementById('cart-summary');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<div id="empty-cart" class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">üõí</div><p>Tu carrito est√° vac√≠o</p><p class="text-sm">¬°Agrega algunos jugos deliciosos!</p></div>';
                cartSummary.classList.add('hidden');
            } else {
                cartSummary.classList.remove('hidden');
                
                let cartHTML = '';
                let subtotal = 0;
                
                cart.forEach(item => {
                    const itemTotal = item.price;
                    subtotal += itemTotal;
                    
                    cartHTML += `
                        <div class="border-b border-gray-200 pb-4 mb-4 last:border-b-0">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex-1 pr-2">
                                    <h4 class="font-bold text-gray-800 mb-1">${item.name}</h4>
                                    ${item.customName ? `<p class="text-xs text-purple-600 italic font-medium mb-1">‚ú® "${item.customName}"</p>` : ''}
                                    <div class="text-xs text-gray-600 space-y-1">
                                        <p>üìè Tama√±o: ${item.size === '16oz' ? '16oz (Chico)' : '24oz (Grande)'}</p>
                                        <p>ü•§ Preparaci√≥n: ${item.preparation}</p>
                                        <p>üçØ Endulzante: ${item.sweetener}</p>
                                        ${item.extras.length > 0 ? `<p>üåà Extras: ${item.extras.join(', ')}</p>` : ''}
                                    </div>
                                </div>
                                <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 p-1">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="flex justify-between items-center bg-gray-50 p-2 rounded-lg">
                                <div class="flex items-center gap-2">
                                    <span class="text-sm font-bold min-w-[20px] text-center">1</span>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-green-600">$${itemTotal}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                cartItems.innerHTML = cartHTML;
                
                let shippingText = 'Puede variar de acuerdo a la ubicaci√≥n';
                let total = subtotal;
                
                if (selectedDelivery === 'tienda') {
                     shippingText = '$0';
                     total = subtotal;
                }
                
                document.getElementById('cart-subtotal').textContent = `$${subtotal}`;
                document.getElementById('cart-shipping').innerHTML = shippingText;
                document.getElementById('cart-total').textContent = `$${total}`;
            }
        }

        function removeFromCart(itemId) {
            cart = cart.filter(item => item.id !== itemId);
            updateCartCount();
            updateCartDisplay();
        }

        function toggleCart() {
            const cartModal = document.getElementById('cart-modal');
            cartModal.classList.toggle('hidden');
            if (!cartModal.classList.contains('hidden')) {
                updateCartDisplay();
            }
        }

        function proceedToCheckout() {
            if (cart.length === 0) {
                showModal('‚ö†Ô∏è', 'Tu carrito est√° vac√≠o. Por favor, agrega un jugo para continuar.');
                return;
            }
            toggleCart();
            document.getElementById('delivery-section').classList.remove('hidden');
            document.getElementById('payment-section').classList.remove('hidden');
            document.getElementById('order-summary').classList.add('hidden');
            setTimeout(() => {
                const deliverySection = document.getElementById('delivery-section');
                if (deliverySection) {
                    deliverySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        function showFinalOrderSummary() {
            if (!selectedDelivery || !selectedPayment) {
                 return;
            }

            const summary = document.getElementById('order-summary');
            const details = document.getElementById('order-details');
            const totalPrice = document.getElementById('total-price');
            const whatsappBtn = document.getElementById('whatsapp-btn');
            
            let subtotal = cart.reduce((total, item) => total + item.price, 0);
            
            let orderText = `<div class="font-bold mb-2">üõí Resumen del Carrito (${cart.length} productos)</div>`;
            
            cart.forEach((item, index) => {
                orderText += `<div class="text-xs mb-2 bg-white bg-opacity-20 p-2 rounded">`;
                orderText += `<div class="font-medium">${index + 1}. ${item.name}`;
                if (item.customName) {
                    orderText += ` - "${item.customName}"`;
                }
                orderText += `</div>`;
                orderText += `<div>Tama√±o: ${item.size === '16oz' ? '16oz (Chico)' : '24oz (Grande)'}</div>`;
                if (item.extras.length > 0) {
                    orderText += `<div>Extras: ${item.extras.join(', ')}</div>`;
                }
                orderText += `<div>Preparaci√≥n: ${item.preparation} | Endulzante: ${item.sweetener}</div>`;
                orderText += `<div class="font-medium">Precio: $${item.price} MXN</div>`;
                orderText += `</div>`;
            });
            
            orderText += `<div class="mt-2 pt-2 border-t border-white border-opacity-30">`;
            orderText += `<div>üì¶ Entrega: ${selectedDelivery === 'tienda' ? 'Recoger en tienda' : 'Env√≠o a domicilio'}</div>`;
            orderText += `<div>üí≥ Pago: ${selectedPayment === 'efectivo' ? 'Efectivo' : 'Transferencia HSBC'}</div>`;
            orderText += `</div>`;
            
            details.innerHTML = orderText;

            if (selectedDelivery === 'domicilio') {
                 // No mostrar total fijo, ya que el costo de env√≠o es variable
                totalPrice.innerHTML = `Subtotal: $${subtotal} + Env√≠o: Puede variar = Total: Pendiente de confirmaci√≥n`;
            } else { // 'tienda'
                totalPrice.innerHTML = `Subtotal: $${subtotal} + Env√≠o: $0 = Total: $${subtotal} MXN`;
            }

            // L√≥gica para habilitar/deshabilitar el bot√≥n de WhatsApp
            const colonia = document.getElementById('colonia').value.trim();
            const calle = document.getElementById('calle').value.trim();
            const numero = document.getElementById('numero').value.trim();
            const telefono = document.getElementById('telefono').value.trim();

            if (selectedDelivery === 'domicilio' && (!colonia || !calle || !numero || !telefono)) {
                whatsappBtn.disabled = true;
                whatsappBtn.classList.add('opacity-50', 'cursor-not-allowed');
                whatsappBtn.innerHTML = 'Complete los datos de domicilio';
            } else {
                whatsappBtn.disabled = false;
                whatsappBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                whatsappBtn.innerHTML = 'Enviar Pedido por WhatsApp';
            }

            summary.classList.remove('hidden');
        }

        function checkAndEnableWhatsapp() {
            showFinalOrderSummary();
        }
        
        function sendWhatsApp() {
            let message = `üçπ ¬°Hola! Quiero hacer un pedido de FruitBox\n\n`;
            
            if (cart.length === 0) {
                showModal('‚ö†Ô∏è', 'Tu carrito est√° vac√≠o. Por favor, agrega un jugo para continuar.');
                return;
            }

            let subtotal = 0;
            message += `üõí MI PEDIDO (${cart.length} productos):\n\n`;
            
            cart.forEach((item, index) => {
                subtotal += item.price;
                message += `${index + 1}. ${item.name}\n`;
                if (item.customName) {
                    message += `   ‚ú® "${item.customName}"\n`;
                }
                message += `   üìè Tama√±o: ${item.size === '16oz' ? '16 oz (Chico)' : '24 oz (Grande)'}\n`;
                message += `   ü•§ Preparaci√≥n: ${item.preparation}\n`;
                message += `   üçØ Endulzante: ${item.sweetener}\n`;
                if (item.extras.length > 0) {
                    message += `   üåà Extras: ${item.extras.join(', ')}\n`;
                }
                message += `   üí∞ Precio: $${item.price} MXN\n\n`;
            });
            
            let finalTotal = subtotal;
            
            message += `üí∞ RESUMEN:\n`;
            message += `   Subtotal: $${subtotal} MXN\n`;
            
            if (selectedDelivery === 'domicilio') {
                message += `   Env√≠o: Puede variar de acuerdo a la ubicaci√≥n\n`;
                message += `   üéØ TOTAL: Pendiente de confirmaci√≥n\n\n`;
            } else { // 'tienda'
                message += `   Env√≠o: $0 MXN\n`;
                message += `   üéØ TOTAL: $${finalTotal} MXN\n\n`;
            }
            
            if (!selectedPayment) {
                 showModal('‚ö†Ô∏è', 'Por favor, selecciona un m√©todo de pago.');
                 return;
            }
            message += `üí≥ M√©todo de pago: ${selectedPayment === 'efectivo' ? 'Efectivo' : 'Transferencia HSBC'}\n\n`;
            
            if (selectedDelivery === 'domicilio') {
                const colonia = document.getElementById('colonia').value;
                const calle = document.getElementById('calle').value;
                const numero = document.getElementById('numero').value;
                const privada = document.getElementById('privada').value;
                const codigo = document.getElementById('codigo').value;
                const telefono = document.getElementById('telefono').value;

                if (!colonia || !calle || !numero || !telefono) {
                    showModal('‚ö†Ô∏è', 'Por favor, complete los datos de domicilio.');
                    return;
                }

                message += `üöó ENV√çO A DOMICILIO:\n`;
                message += `üèòÔ∏è Colonia: ${colonia}\n`;
                message += `üõ£Ô∏è Calle: ${calle}\n`;
                message += `üè† N√∫mero exterior: ${numero}\n`;
                if (privada) message += `üèòÔ∏è Privada: ${privada}\n`;
                if (codigo) message += `üîë C√≥digo de acceso: ${codigo}\n`;
                message += `üì± Tel√©fono: ${telefono}\n\n`;

                if (selectedPayment === 'transferencia') {
                    message += `üí≥ INFORMACI√ìN PARA TRANSFERENCIA:\n`;
                    message += `üè¶ Banco: HSBC\n`;
                    message += `üë§ Titular: Alan Stephen Vega Chacon\n`;
                    message += `üí∞ Monto a transferir: $${finalTotal} MXN\n\n`;
                    message += `üìÑ Por favor env√≠a el comprobante de transferencia para confirmar tu pedido.\n\n`;
                }
            } else if (selectedDelivery === 'tienda') {
                message += `üè™ RECOGER EN TIENDA:\n\n`;
                message += `üìç Direcci√≥n del negocio:\n`;
                message += `üõ£Ô∏è Calle: Saavedra\n`;
                message += `üè† N√∫mero exterior: 1213\n`;
                message += `üèòÔ∏è Privada: Benavente\n`;
                message += `üîë C√≥digo de acceso: 297822#\n`;
                message += `üè° Detalles: Casa caf√© con blanco cerco de malla\n\n`;
                message += `‚ö†Ô∏è Nota: No olvide mostrar una identificaci√≥n oficial para su ingreso.\n\n`;
            }

            message += `üçπ‚ú® ¬°Tu jugo, tu estilo, tu fruitbox! ‚ú®üçπ`;

            const whatsappUrl = `https://wa.me/526862442310?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        function showScheduleModalForJuice() {
            if (!currentOrder.juice || !currentOrder.preparation || !currentOrder.sweetener || !currentOrder.size) {
                showModal('‚ö†Ô∏è', 'Por favor, completa todas las opciones del jugo antes de programar el pedido.');
                return;
            }
            document.getElementById('schedule-modal').classList.remove('hidden');
        }
        
        function hideScheduleModal() {
            document.getElementById('schedule-modal').classList.add('hidden');
        }
        
        function sendScheduledJuiceWhatsApp() {
            const scheduleDate = document.getElementById('scheduled-date').value;
            const scheduleTime = document.getElementById('scheduled-time').value;
            const scheduleNotes = document.getElementById('scheduled-notes').value.trim();
            
            if (!scheduleDate || !scheduleTime) {
                showModal('‚ö†Ô∏è', 'Por favor, selecciona una fecha y hora para programar tu pedido.');
                return;
            }

            let price = juicePrices[currentOrder.juice] || 60;
            if (currentOrder.size === '24oz') {
                price += 10;
            }
            if (currentOrder.extras.length > 3) {
                price += (currentOrder.extras.length - 3) * 5;
            }

            let message = `üìÖ ¬°Hola! Me gustar√≠a programar un pedido de FruitBox para el futuro.\n\n`;
            message += `üóìÔ∏è **Fecha Programada:** ${scheduleDate}\n`;
            message += `‚è∞ **Hora Programada:** ${scheduleTime}\n\n`;
            
            if (scheduleNotes) {
                message += `üìù **Notas:** ${scheduleNotes}\n\n`;
            }

            message += `ü•§ **DETALLES DEL JUGO:**\n`;
            message += `   Nombre: ${juiceNames[currentOrder.juice]}\n`;
            const customName = document.getElementById('custom-name').value.trim();
            if (currentOrder.juice === 'personalizado' && customName) {
                message += `   Creaci√≥n: "${customName}"\n`;
            }
            message += `   Tama√±o: ${currentOrder.size === '16oz' ? '16 oz (Chico)' : '24 oz (Grande)'}\n`;
            message += `   Preparaci√≥n: ${currentOrder.preparation}\n`;
            message += `   Endulzante: ${currentOrder.sweetener}\n`;
            if (currentOrder.extras.length > 0) {
                message += `   Extras: ${currentOrder.extras.join(', ')}\n`;
            }
            message += `   Precio estimado: $${price} MXN\n\n`;

            message += `üè™ **INFORMACI√ìN DE RECOGIDA:**\n`;
            message += `Recoger√© mi pedido en la tienda. Favor de tenerlo listo a la hora indicada.\n`;
            message += `üìç Direcci√≥n: Saavedra 1213, Privada Benavente\n`;
            message += `‚ö†Ô∏è Nota: No olvide mostrar una identificaci√≥n oficial para su ingreso.\n\n`;

            message += `üçπ‚ú® ¬°Gracias! ‚ú®üçπ`;

            const whatsappUrl = `https://wa.me/526862442310?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            hideScheduleModal();
            resetJuiceSelection();
        }
    </script>
</body>
</html>
